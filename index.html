<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NANO INTELLIGENCE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; color: #0f172a; }
        /* تصميم يحاكي ChatGPT */
        .chat-container { height: calc(100vh - 180px); overflow-y: auto; scroll-behavior: smooth; }
        .message { max-width: 85%; padding: 1rem; border-radius: 1rem; margin-bottom: 1rem; line-height: 1.6; }
        .user-msg { background-color: #2563eb; color: white; margin-right: auto; border-bottom-right-radius: 0.2rem; }
        .ai-msg { background-color: white; border: 1px solid #e2e8f0; color: #334155; margin-left: auto; border-bottom-left-radius: 0.2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #cbd5e1; border-radius: 50%; animation: typing 1s infinite; margin: 0 2px; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        /* زرار التبديل */
        .nav-btn { cursor: pointer; padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 700; transition: all 0.2s; }
        .nav-btn.active { background-color: #0f172a; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .nav-btn:not(.active) { color: #64748b; background: transparent; }
        .nav-btn:not(.active):hover { background-color: #e2e8f0; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <header class="bg-white border-b border-gray-200 p-4 shadow-sm flex justify-between items-center z-10">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-blue-200">N</div>
            <div>
                <h1 class="font-bold text-xl tracking-tight text-slate-800">NANO AI</h1>
                <p class="text-xs text-slate-500 font-medium">Enterprise Grade System</p>
            </div>
        </div>
        <div class="flex bg-slate-100 p-1 rounded-full">
            <button onclick="switchMode('chat')" id="btn-chat" class="nav-btn active">محادثة</button>
            <button onclick="switchMode('image')" id="btn-image" class="nav-btn">صور</button>
        </div>
    </header>

    <main id="chat-view" class="flex-1 flex flex-col max-w-5xl mx-auto w-full p-4 relative">
        <div id="chat-box" class="chat-container pb-4">
            <div class="ai-msg message w-fit">
                أهلاً بك. أنا نظام NANO المتطور. كيف يمكنني مساعدتك اليوم؟ (شات، برمجة، تحليل بيانات)
            </div>
        </div>

        <div class="absolute bottom-6 left-4 right-4 max-w-4xl mx-auto">
            <div class="relative shadow-xl rounded-2xl bg-white border border-gray-200 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                <textarea id="chatInput" class="w-full p-4 pr-16 rounded-2xl outline-none resize-none text-gray-700 max-h-32 bg-transparent" placeholder="اكتب رسالتك هنا..." rows="1" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                <button onclick="sendMessage()" class="absolute left-2 bottom-2 bg-blue-600 hover:bg-blue-700 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
            <p class="text-center text-xs text-slate-400 mt-2">NANO AI may produce inaccurate information about people, places, or facts.</p>
        </div>
    </main>

    <main id="image-view" class="hidden flex-1 flex-col max-w-4xl mx-auto w-full p-6 items-center justify-center">
        <div class="w-full bg-white p-8 rounded-3xl border border-gray-200 shadow-xl text-center">
            <h2 class="text-3xl font-black text-slate-800 mb-2">توليد الصور الاحترافي</h2>
            <p class="text-slate-500 mb-8">حول كلماتك إلى لوحات فنية باستخدام أحدث تقنيات الذكاء الاصطناعي.</p>
            
            <div class="flex gap-2 mb-8">
                <input id="imgInput" type="text" class="w-full p-4 rounded-xl border-2 border-gray-200 outline-none focus:border-blue-500 text-lg" placeholder="صف الصورة التي تريدها (مثلاً: قطة ترتدي نظارة في الفضاء)...">
                <button onclick="generateImage()" class="bg-black text-white px-8 py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-lg whitespace-nowrap">إنشاء ✨</button>
            </div>

            <div id="image-result" class="min-h-[400px] flex items-center justify-center bg-slate-50 rounded-2xl border-2 border-dashed border-slate-300 relative overflow-hidden">
                <p class="text-slate-400 font-medium">ستظهر النتيجة هنا...</p>
            </div>
        </div>
    </main>

    <script>
        // التبديل بين الشات والصور
        function switchMode(mode) {
            document.getElementById('chat-view').classList.toggle('hidden', mode !== 'chat');
            document.getElementById('image-view').classList.toggle('hidden', mode !== 'image');
            document.getElementById('btn-chat').classList.toggle('active', mode === 'chat');
            document.getElementById('btn-image').classList.toggle('active', mode === 'image');
        }

        // منطق الشات (بدون مفتاحك - سيرفر مفتوح)
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const box = document.getElementById('chat-box');
            const text = input.value.trim();
            if (!text) return;

            // إضافة رسالة المستخدم
            box.innerHTML += `<div class="user-msg message">${text}</div>`;
            input.value = '';
            box.scrollTop = box.scrollHeight;

            // مؤشر الكتابة
            const loadingId = 'loading-' + Date.now();
            box.innerHTML += `<div id="${loadingId}" class="ai-msg message typing-indicator"><span></span><span></span><span></span></div>`;
            box.scrollTop = box.scrollHeight;

            try {
                // استخدام API Pollinations للنصوص (GPT Wrapper)
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(text)}`);
                const reply = await response.text();
                
                document.getElementById(loadingId).remove();
                // تحويل Markdown لـ HTML وعرضه
                box.innerHTML += `<div class="ai-msg message">${marked.parse(reply)}</div>`;
                
                // النطق
                const speech = new SpeechSynthesisUtterance(reply);
                speech.lang = 'ar-SA';
                window.speechSynthesis.speak(speech);

            } catch (e) {
                document.getElementById(loadingId).innerHTML = "عذراً، حدث خطأ في الاتصال بالسيرفر.";
            }
            box.scrollTop = box.scrollHeight;
        }

        // منطق الصور
        function generateImage() {
            const prompt = document.getElementById('imgInput').value;
            if (!prompt) return;
            
            const container = document.getElementById('image-result');
            container.innerHTML = `<div class="animate-spin w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full"></div>`;
            
            // رابط مباشر للصورة (Caching Bypassed)
            const imageUrl = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=1280&height=720&seed=${Math.random()}&model=flux`;
            
            const img = new Image();
            img.src = imageUrl;
            img.onload = () => {
                container.innerHTML = `<img src="${imageUrl}" class="w-full h-full object-cover rounded-xl shadow-md animate-in fade-in">`;
            };
            img.onerror = () => {
                container.innerHTML = `<p class="text-red-500">فشل تحميل الصورة، حاول بوصف آخر.</p>`;
            }
        }
    </script>
</body>
</html>
</html>
